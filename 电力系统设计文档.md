# ç”µåŠ›ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ âš¡

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

ç”µåŠ›ç³»ç»Ÿæ˜¯å·¥å‚è‡ªåŠ¨åŒ–çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œè´Ÿè´£ç®¡ç†ä»å‘ç”µåˆ°é…ç”µçš„å®Œæ•´ç”µåŠ›ç”Ÿäº§é“¾ã€‚æœ¬ç³»ç»Ÿå®ç°äº†Factorioé£æ ¼çš„ç”µåŠ›ç®¡ç†ï¼ŒåŒ…æ‹¬å¤šç§å‘ç”µæ–¹å¼ã€å®æ—¶è´Ÿè½½ç›‘æ§å’Œæ™ºèƒ½èµ„æºç®¡ç†ã€‚

## ğŸ”‹ ç”µåŠ›ç”Ÿäº§é“¾

### åŸºç¡€ç”Ÿäº§é“¾
```
æ°´æº â†’ æµ·æ°´æ³µ(30kW) â†’ æ°´å‚¨å­˜ â†’ é”…ç‚‰ + ç…¤ç‚­ â†’ è’¸æ±½ â†’ è’¸æ±½æœº(900kW) â†’ ç”µåŠ›ç½‘
```

### è¯¦ç»†æµç¨‹
1. **æ°´æºè·å–** - æµ·æ°´æ³µæ— é™äº§ç”Ÿæ°´æº
2. **è’¸æ±½ç”Ÿäº§** - é”…ç‚‰ç‡ƒçƒ§ç…¤ç‚­åŠ çƒ­æ°´äº§ç”Ÿè’¸æ±½
3. **ç”µåŠ›å‘ç”µ** - è’¸æ±½æœºæ¶ˆè€—è’¸æ±½è½¬æ¢ä¸ºç”µåŠ›
4. **ç”µåŠ›æ¶ˆè€—** - å„ç§ç”µåŠ¨è®¾æ–½æ¶ˆè€—ç”µåŠ›è¿è¡Œ

## ğŸ­ å‘ç”µè®¾å¤‡è¯¦è§£

### æµ·æ°´æ³µ (Offshore Pump)
```typescript
{
  name: 'æµ·æ°´æ³µ',
  category: 'power-generation',
  powerType: 'electric',
  powerConsumption: 30, // kW
  äº§å‡º: 20, // å•ä½æ°´/ç§’
  ç‰¹ç‚¹: 'æ— é™æ°´æºï¼Œéœ€è¦ç”µåŠ›å¯åŠ¨'
}
```

### é”…ç‚‰ (Boiler)
```typescript
{
  name: 'é”…ç‚‰',
  category: 'power-generation', 
  powerType: 'fuel',
  è¾“å…¥: {
    ç…¤ç‚­: 1.8, // å•ä½/ç§’
    æ°´: 60     // å•ä½/ç§’
  },
  äº§å‡º: 60,    // å•ä½è’¸æ±½/ç§’
  ç‰¹ç‚¹: 'ç‡ƒæ–™é©±åŠ¨ï¼Œæ— éœ€ç”µåŠ›'
}
```

### è’¸æ±½æœº (Steam Engine)
```typescript
{
  name: 'è’¸æ±½æœº',
  category: 'power-generation',
  powerType: 'none',
  è¾“å…¥: 30,           // å•ä½è’¸æ±½/ç§’
  powerGeneration: 900, // kW
  ç‰¹ç‚¹: 'ä¸»è¦å‘ç”µè®¾å¤‡'
}
```

## âš¡ ç”µåŠ›ç®¡ç†ç³»ç»Ÿ

### PowerService æ ¸å¿ƒæœåŠ¡

#### ç³»ç»ŸçŠ¶æ€ç®¡ç†
```typescript
interface PowerSystemState {
  totalGeneration: number;      // æ€»å‘ç”µé‡(kW)
  totalConsumption: number;     // æ€»æ¶ˆè€—é‡(kW) 
  powerBalance: number;         // ç”µåŠ›å¹³è¡¡(kW)
  efficiency: number;           // ç”µç½‘æ•ˆç‡(0-1)
  powerStatus: 'surplus' | 'balanced' | 'deficit'; // ç”µåŠ›çŠ¶æ€
}
```

#### å‘ç”µè®¾å¤‡çŠ¶æ€
```typescript
interface PowerFacilityState {
  facilityId: string;
  type: string;
  count: number;
  powerGeneration: number;      // å‘ç”µé‡
  powerConsumption: number;     // æ¶ˆè€—é‡
  fuelConsumption: number;      // ç‡ƒæ–™æ¶ˆè€—
  status: 'running' | 'stopped' | 'fuel-shortage';
}
```

### æ ¸å¿ƒåŠŸèƒ½æ–¹æ³•

#### 1. ç”µåŠ›ç³»ç»ŸçŠ¶æ€è®¡ç®—
```typescript
updatePowerState(): void {
  const allFacilities = facilityService.getAllFacilities();
  
  let totalGeneration = 0;
  let totalConsumption = 0;

  allFacilities.forEach(facility => {
    const facilityType = facilityService.getFacilityType(facility.type);
    
    if (facilityType?.powerGeneration) {
      totalGeneration += facilityType.powerGeneration * facility.count;
    }
    
    if (facilityType?.powerConsumption) {
      totalConsumption += facilityType.powerConsumption * facility.count;
    }
  });

  const powerBalance = totalGeneration - totalConsumption;
  // ... çŠ¶æ€è®¡ç®—é€»è¾‘
}
```

#### 2. å‘ç”µè®¾å¤‡ç®¡ç†
```typescript
addPowerFacility(facilityType: string, itemId: string, count: number): boolean {
  // éªŒè¯è®¾æ–½ç±»å‹
  const facilityTemplate = facilityService.getFacilityType(facilityType);
  if (!facilityTemplate || facilityTemplate.category !== 'power-generation') {
    return false;
  }

  // é…ç½®è¾“å…¥è¾“å‡ºç‡
  const baseInputRate: Record<string, number> = {};
  let baseOutputRate = 0;

  switch(facilityType) {
    case 'offshore-pump':
      baseOutputRate = 1200; // æ¯ç§’1200å•ä½æ°´
      break;
    case 'boiler':
      baseInputRate['coal'] = 1.8;
      baseInputRate['water'] = 60;
      baseOutputRate = 60; // æ¯ç§’60å•ä½è’¸æ±½
      break;
    case 'steam-engine':
      baseInputRate['steam'] = 30;
      baseOutputRate = 0; // ç”µåŠ›ä¸ä½œä¸ºç‰©å“
      break;
  }

  // æ·»åŠ åˆ°è®¾æ–½æœåŠ¡
  facilityService.addFacility(itemId, { /* è®¾æ–½é…ç½® */ });
  return true;
}
```

#### 3. ç”µåŠ›ç”Ÿäº§æ¨¡æ‹Ÿ
```typescript
simulatePowerProduction(): void {
  const powerFacilities = this.getPowerFacilities();
  
  powerFacilities.forEach(facility => {
    if (facility.status !== 'running') return;

    switch(facility.type) {
      case 'offshore-pump':
        // äº§ç”Ÿæ°´
        const waterProduced = facility.count * 20;
        dataService.updateInventory('water', {
          productionRate: waterProduced
        });
        break;
        
      case 'boiler':
        // æ£€æŸ¥ç‡ƒæ–™å’Œæ°´ï¼Œäº§ç”Ÿè’¸æ±½
        const coalNeeded = facility.fuelConsumption;
        const waterNeeded = facility.count * 60;
        
        if (this.hasEnoughResources('coal', coalNeeded) && 
            this.hasEnoughResources('water', waterNeeded)) {
          this.consumeResources('coal', coalNeeded);
          this.consumeResources('water', waterNeeded);
          this.produceResource('steam', facility.count * 60);
        }
        break;
        
      case 'steam-engine':
        // æ¶ˆè€—è’¸æ±½å‘ç”µ
        const steamNeeded = facility.fuelConsumption;
        if (this.hasEnoughResources('steam', steamNeeded)) {
          this.consumeResources('steam', steamNeeded);
          // ç”µåŠ›äº§ç”Ÿåœ¨çŠ¶æ€ä¸­è®°å½•ï¼Œä¸å­˜å‚¨ä¸ºç‰©å“
        }
        break;
    }
  });
}
```

## ğŸ›ï¸ ç”¨æˆ·ç•Œé¢è®¾è®¡

### PowerManagementPanel ç»„ä»¶æ¶æ„

#### ç”µåŠ›çŠ¶æ€æ€»è§ˆå¡ç‰‡
```typescript
<Grid container spacing={2}>
  <Grid item xs={4}>
    <PowerCard>
      <Typography variant="h6">âš¡ æ€»å‘ç”µé‡</Typography>
      <Typography variant="h4">{totalGeneration} kW</Typography>
    </PowerCard>
  </Grid>
  <Grid item xs={4}>
    <PowerCard>
      <Typography variant="h6">ğŸ”Œ æ€»æ¶ˆè€—é‡</Typography>
      <Typography variant="h4">{totalConsumption} kW</Typography>
    </PowerCard>
  </Grid>
  <Grid item xs={4}>
    <PowerCard>
      <Typography variant="h6">ğŸ“Š ç”µåŠ›å¹³è¡¡</Typography>
      <Typography variant="h4" color={balanceColor}>
        {powerBalance >= 0 ? '+' : ''}{powerBalance} kW
      </Typography>
    </PowerCard>
  </Grid>
</Grid>
```

#### ç”µç½‘æ•ˆç‡å¯è§†åŒ–
```typescript
<PowerBar 
  variant="determinate" 
  value={efficiency * 100}
  status={powerStatus}
  sx={{
    '& .MuiLinearProgress-bar': {
      backgroundColor: 
        status === 'surplus' ? '#4caf50' : 
        status === 'deficit' ? '#f44336' : '#2196f3'
    }
  }}
/>
```

#### å‘ç”µè®¾å¤‡å¿«é€Ÿæ“ä½œ
```typescript
<Box display="flex" gap={1}>
  <Button startIcon={<WaterDropIcon />} 
          onClick={() => handleAddPowerFacility('offshore-pump', 'water')}>
    æ·»åŠ æµ·æ°´æ³µ
  </Button>
  <Button startIcon={<FireplaceIcon />}
          onClick={() => handleAddPowerFacility('boiler', 'steam')}>
    æ·»åŠ é”…ç‚‰
  </Button>
  <Button startIcon={<BoltIcon />}
          onClick={() => handleAddPowerFacility('steam-engine', 'power')}>
    æ·»åŠ è’¸æ±½æœº
  </Button>
</Box>
```

### ç‰©å“è¯¦æƒ…é¡µé¢é›†æˆ

#### æ°´è¯¦æƒ…é¡µé¢
```typescript
// åœ¨æ°´çš„ItemDetailDialogä¸­æ·»åŠ 
if (item.id === 'water') {
  return (
    <DataCard>
      <Typography variant="subtitle2" color="primary">
        ğŸ’§ æ°´æ³µè®¾æ–½
      </Typography>
      <Typography variant="body2">
        æµ·æ°´æ³µå¯ä»¥æ— é™äº§ç”Ÿæ°´æº
      </Typography>
      <ActionButton onClick={() => powerService.addPowerFacility('offshore-pump', 'water', 1)}>
        â• æ·»åŠ æµ·æ°´æ³µ
      </ActionButton>
      <Typography variant="caption">
        äº§å‡º: 20å•ä½/ç§’æ°´ | æ¶ˆè€—: 30kWç”µåŠ›
      </Typography>
    </DataCard>
  );
}
```

#### è’¸æ±½è¯¦æƒ…é¡µé¢
```typescript
// åœ¨è’¸æ±½çš„ItemDetailDialogä¸­æ·»åŠ 
if (item.id === 'steam') {
  return (
    <DataCard>
      <Typography variant="subtitle2" color="primary">
        ğŸ”¥ è’¸æ±½ç”Ÿäº§
      </Typography>
      <Typography variant="body2">
        é”…ç‚‰çƒ§ç…¤äº§ç”Ÿè’¸æ±½
      </Typography>
      <ActionButton onClick={() => powerService.addPowerFacility('boiler', 'steam', 1)}>
        â• æ·»åŠ é”…ç‚‰
      </ActionButton>
      <Typography variant="caption">
        äº§å‡º: 60å•ä½/ç§’è’¸æ±½ | æ¶ˆè€—: 1.8ç…¤ç‚­/ç§’ + 60æ°´/ç§’
      </Typography>
    </DataCard>
  );
}
```

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### è®¾æ–½ç±»å‹æ‰©å±•
```typescript
// æ‰©å±•Facilityæ¥å£æ”¯æŒç”µåŠ›
interface Facility {
  // ... ç°æœ‰å­—æ®µ
  powerGeneration?: number;  // å‘ç”µé‡(kW)
  category: 'mining' | 'smelting' | 'crafting' | 'chemical' | 'research' | 'power-generation';
}

// æ‰©å±•FacilityTemplate
interface FacilityTemplate {
  // ... ç°æœ‰å­—æ®µ
  powerGeneration?: number;
  fuelTypes?: string[];
}
```

### æ™ºèƒ½å»ºè®®ç³»ç»Ÿ
```typescript
getPowerBalanceRecommendations(): string[] {
  const state = this.getPowerSystemState();
  const recommendations: string[] = [];

  if (state.powerStatus === 'deficit') {
    recommendations.push(`ç”µåŠ›ä¸è¶³ï¼ç¼ºå°‘${Math.abs(state.powerBalance)}kW`);
    recommendations.push('å»ºè®®ï¼šå¢åŠ è’¸æ±½æœºæ•°é‡æˆ–æ£€æŸ¥ç‡ƒæ–™ä¾›åº”');
  } else if (state.powerStatus === 'surplus') {
    recommendations.push(`ç”µåŠ›è¿‡å‰©ï¼å¤šä½™${state.powerBalance}kW`);
    recommendations.push('å»ºè®®ï¼šå¯ä»¥å¢åŠ æ›´å¤šç”¨ç”µè®¾å¤‡');
  }

  // æ£€æŸ¥ç‡ƒæ–™çŠ¶æ€
  const powerFacilities = this.getPowerFacilities();
  const fuelShortage = powerFacilities.filter(f => f.status === 'fuel-shortage');
  
  if (fuelShortage.length > 0) {
    recommendations.push(`${fuelShortage.length}ä¸ªå‘ç”µè®¾å¤‡ç‡ƒæ–™ä¸è¶³`);
    recommendations.push('å»ºè®®ï¼šæ£€æŸ¥ç…¤ç‚­å’Œæ°´çš„ä¾›åº”');
  }

  return recommendations;
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ›´æ–°é¢‘ç‡æ§åˆ¶
- **ç”µåŠ›çŠ¶æ€æ›´æ–°**: æ¯3ç§’æ›´æ–°ä¸€æ¬¡
- **ç”Ÿäº§æ¨¡æ‹Ÿ**: æ¯5ç§’æ‰§è¡Œä¸€æ¬¡
- **UIåˆ·æ–°**: è·ŸéšçŠ¶æ€æ›´æ–°ï¼Œé¿å…é¢‘ç¹é‡ç»˜

### å†…å­˜ç®¡ç†
- **è®¾æ–½çŠ¶æ€ç¼“å­˜**: é¿å…é‡å¤è®¡ç®—
- **äº‹ä»¶ç›‘å¬ä¼˜åŒ–**: ç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
- **æ•°æ®ç»“æ„ä¼˜åŒ–**: ä½¿ç”¨Mapæé«˜æŸ¥æ‰¾æ•ˆç‡

## ğŸ”® æœªæ¥æ‰©å±•

### é«˜çº§å‘ç”µè®¾å¤‡
- **å¤ªé˜³èƒ½æ¿** - æ—¥é—´å‘ç”µï¼Œæ— ç‡ƒæ–™æ¶ˆè€—
- **æ ¸ååº”å †** - é«˜æ•ˆå‘ç”µï¼Œéœ€è¦é“€ç‡ƒæ–™
- **é£åŠ›å‘ç”µ** - éšæœºæ€§å‘ç”µ

### ç”µåŠ›å­˜å‚¨ç³»ç»Ÿ
- **è“„ç”µæ± ** - å­˜å‚¨å¤šä½™ç”µåŠ›
- **ç”µå®¹å™¨** - çŸ­æœŸç”µåŠ›ç¼“å†²
- **è¶…çº§ç”µå®¹** - é«˜å®¹é‡å‚¨èƒ½

### æ™ºèƒ½ç”µç½‘
- **ç”µåŠ›ä¼˜å…ˆçº§** - é‡è¦è®¾æ–½ä¼˜å…ˆä¾›ç”µ
- **è´Ÿè½½å¹³è¡¡** - åŠ¨æ€è°ƒæ•´è®¾æ–½è¿è¡Œ
- **åŒºåŸŸç”µç½‘** - ç‹¬ç«‹çš„ç”µåŠ›åŒºåŸŸç®¡ç†

### ç”µåŠ›ä¼ è¾“
- **ç”µçº¿ç½‘ç»œ** - å¯è§†åŒ–ç”µåŠ›ä¼ è¾“
- **å˜ç”µç«™** - ç”µå‹è½¬æ¢å’Œåˆ†é…
- **ç”µåŠ›æŸè€—** - é•¿è·ç¦»ä¼ è¾“æŸè€—

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡

### ç”µåŠ›æ¶ˆè€—è®¾å¤‡ç»Ÿè®¡
| è®¾å¤‡ç±»å‹ | ç”µåŠ›æ¶ˆè€—(kW) | æ•°é‡å€æ•° |
|---------|-------------|---------|
| ç”µåŠ›é‡‡æ˜æœº | 90 | 7å° |
| è£…é…æœº2å‹ | 150 | å¤šå° |
| è£…é…æœº3å‹ | 375 | å°‘é‡ |
| ç”µç‚‰ | 180 | å¤šå° |
| åŒ–å·¥å‚ | 210 | ä¸­ç­‰ |
| ç‚¼æ²¹å‚ | 420 | å°‘é‡ |
| ç ”ç©¶å®éªŒå®¤ | 60 | å°‘é‡ |
| æµ·æ°´æ³µ | 30 | å°‘é‡ |

### å‘ç”µæ•ˆç‡åˆ†æ
- **1å°è’¸æ±½æœº**: 900kW â‰ˆ æ”¯æŒ10å°ç”µåŠ›é‡‡æ˜æœº
- **1å°é”…ç‚‰**: æ”¯æŒ1å°è’¸æ±½æœºæ»¡è½½è¿è¡Œ
- **1å°æµ·æ°´æ³µ**: æ”¯æŒ3å°é”…ç‚‰ç”¨æ°´éœ€æ±‚

## âœ… æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•æ¸…å•
- [x] æµ·æ°´æ³µæ­£å¸¸äº§æ°´
- [x] é”…ç‚‰æ­£å¸¸æ¶ˆè€—ç‡ƒæ–™äº§è’¸æ±½
- [x] è’¸æ±½æœºæ­£å¸¸æ¶ˆè€—è’¸æ±½å‘ç”µ
- [x] ç”µåŠ›å¹³è¡¡è®¡ç®—å‡†ç¡®
- [x] ç‡ƒæ–™ä¸è¶³æ£€æµ‹å·¥ä½œ
- [x] UIçŠ¶æ€å®æ—¶æ›´æ–°
- [x] è®¾å¤‡å¿«é€Ÿæ·»åŠ åŠŸèƒ½
- [x] æ™ºèƒ½å»ºè®®ç³»ç»Ÿ

### æ€§èƒ½æµ‹è¯•
- [x] å¤§é‡è®¾æ–½åŒæ—¶è¿è¡Œ
- [x] å®æ—¶æ›´æ–°æ€§èƒ½è‰¯å¥½
- [x] å†…å­˜ä½¿ç”¨ç¨³å®š
- [x] UIå“åº”æµç•…

## ğŸ“ å¼€å‘æ€»ç»“

ç”µåŠ›ç³»ç»Ÿä½œä¸ºç¬¬ä¸€é˜¶æ®µçš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒæˆåŠŸå®ç°äº†ï¼š

1. **å®Œæ•´çš„ç”µåŠ›ç”Ÿäº§é“¾** - ä»æ°´æºåˆ°ç”µåŠ›çš„å®Œæ•´æµç¨‹
2. **æ™ºèƒ½ç®¡ç†ç³»ç»Ÿ** - è‡ªåŠ¨åŒ–çš„çŠ¶æ€ç›‘æ§å’Œå»ºè®®
3. **ç”¨æˆ·å‹å¥½ç•Œé¢** - ç›´è§‚çš„æ“ä½œå’ŒçŠ¶æ€æ˜¾ç¤º
4. **é«˜å¯æ‰©å±•æ€§** - ä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™æ¥å£

è¯¥ç³»ç»Ÿä¸ºåç»­çš„ç§‘æŠ€è§£é”ã€é«˜çº§ç”Ÿäº§è®¾æ–½å’Œå¤æ‚è‡ªåŠ¨åŒ–æä¾›äº†åšå®çš„ç”µåŠ›åŸºç¡€è®¾æ–½æ”¯æŒã€‚