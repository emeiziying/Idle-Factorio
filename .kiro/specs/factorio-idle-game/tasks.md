# 实施计划

- [ ] 1. 建立项目结构和核心接口

  - 创建 TypeScript 项目结构，包含 src、tests、config 目录
  - 定义核心接口和类型定义文件
  - 设置测试框架和构建配置
  - _需求: 7.1, 7.2_

- [ ] 2. 实现资源系统
- [ ] 2.1 创建资源数据模型和验证

  - 实现 Resource 接口和 ResourceManager 类
  - 编写资源添加、消耗和查询的核心方法
  - 创建资源系统的单元测试
  - _需求: 1.1, 1.2, 1.3_

- [ ] 2.2 实现资源生产速率计算

  - 编写生产速率更新逻辑
  - 实现库存上限检查机制
  - 创建生产速率计算的测试用例
  - _需求: 1.3, 1.4_

- [ ] 2.3 添加资源持久化功能

  - 实现资源状态的序列化和反序列化
  - 编写本地存储的读写方法
  - 创建数据持久化的集成测试
  - _需求: 4.1, 4.2_

- [ ] 3. 构建能源和生产系统
- [ ] 3.1 实现能源系统和电力存储

  - 创建 PowerSystem、PowerGenerator、PowerConsumer、Accumulator 接口
  - 实现电力平衡计算，支持电力不足时按满足率降低设施效率的机制
  - 开发燃料系统，支持多种燃料类型和能量值计算
  - 实现蓄电池充放电逻辑和电力存储管理
  - 编写能源系统和电力存储的单元测试
  - _需求: 2.1, 2.2, 2.3_

- [ ] 3.2 实现生产设施和自动化系统

  - 创建 ProductionFacility 类，支持电力和燃料驱动
  - 实现 AutomationManager，管理设施的自动化生产流程
  - 开发生产效率计算逻辑，基于电力满足率、燃料供应、模块效果等因素
  - 编写自动化生产的单元测试
  - _需求: 2.1, 2.2, 2.3_

- [ ] 3.3 开发生产配方系统

  - 实现 Recipe 接口和 RecipeManager 类，支持配方锁定状态管理
  - 创建配方解锁机制，区分默认可用和科技锁定的配方
  - 实现输入输出资源的验证机制和生产者匹配逻辑
  - 编写配方系统和锁定机制的测试用例
  - _需求: 2.3, 5.1, 5.2_

- [ ] 3.4 实现手动操作系统

  - 创建 ManualOperationSystem、HarvestableResource、CraftableItem 接口
  - 实现手动采集逻辑，支持冷却时间和资源再生机制
  - 开发手动制作系统，判断物品是否可手动制作
  - 实现采集和制作的资源消耗和产出逻辑
  - 编写手动操作系统的单元测试
  - _需求: 1.1, 1.2, 2.1_

- [ ] 3.5 构建模块系统和生产链管理器

  - 实现 Module 接口，支持速度、产能、效率、品质模块
  - 开发模块效果计算逻辑，影响生产速度和功耗
  - 实现 ProductionChain 类和资源流动逻辑
  - 开发瓶颈检测和效率计算算法
  - 创建生产链优化的测试场景
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 4. 实现时间控制和离线系统
- [ ] 4.1 创建时间控制器

  - 实现 TimeController 类和游戏时间管理
  - 编写时间更新和同步逻辑
  - 创建时间系统的单元测试
  - _需求: 4.1, 4.2_

- [ ] 4.2 开发离线进度计算器

  - 实现离线时间计算算法
  - 创建资源上限和生产约束的处理逻辑
  - 编写离线计算准确性的测试用例
  - _需求: 4.2, 4.3, 4.4_

- [ ] 4.3 集成离线-在线状态切换

  - 实现游戏状态的保存和恢复机制
  - 创建离线收益的展示和确认流程
  - 编写状态切换的集成测试
  - _需求: 4.1, 4.2, 4.3_

- [ ] 5. 构建科技研发系统
- [ ] 5.1 实现科技树数据结构和前置依赖系统

  - 创建 Technology 接口，包含 prerequisites、unlockedRecipes、researchTrigger 字段
  - 实现 TechnologySystem 类，支持前置依赖的深度优先搜索验证
  - 创建前置依赖检查算法，支持多重依赖关系
  - 编写科技依赖关系的单元测试
  - _需求: 3.1, 3.2, 3.4_

- [ ] 5.2 开发触发式自动解锁机制

  - 实现 ResearchTrigger 接口，支持 craft-item、build-entity、mine-entity 等触发类型
  - 创建玩家行为监控系统，跟踪制造、建造、开采等行为
  - 实现触发条件检查逻辑，支持数量阈值验证
  - 编写自动解锁触发器的测试用例
  - _需求: 3.1, 3.2, 3.3_

- [ ] 5.3 开发传统科技研究机制

  - 实现基于科学包的传统研究系统
  - 创建研究进度跟踪和时间计算逻辑
  - 实现实验室设施的研究功能
  - 编写传统研究流程的测试用例
  - _需求: 3.1, 3.2, 3.3_

- [ ] 5.4 集成科技解锁功能

  - 实现科技完成后的配方解锁逻辑
  - 创建解锁状态的持久化机制
  - 实现科技解锁的级联更新（解锁新科技后检查其他科技的前置条件）
  - 编写科技解锁的集成测试
  - _需求: 3.2, 3.3_

- [ ] 6. 实现升级系统
- [ ] 6.1 创建设施升级机制

  - 实现设施等级和升级成本计算
  - 编写升级效果的应用逻辑
  - 创建升级系统的单元测试
  - _需求: 6.1, 6.2, 6.4_

- [ ] 6.2 开发升级效果系统

  - 实现升级对生产效率的影响计算
  - 创建最高等级限制和状态显示
  - 编写升级效果的测试用例
  - _需求: 6.2, 6.3_

- [ ] 7. 构建游戏管理器
- [ ] 7.1 实现核心游戏循环

  - 创建 GameManager 类和主游戏循环
  - 集成所有子系统的更新调用
  - 编写游戏循环的集成测试
  - _需求: 7.1, 7.2_

- [ ] 7.2 开发游戏状态管理

  - 实现完整的游戏状态序列化
  - 创建自动保存和手动保存机制
  - 编写状态管理的测试用例
  - _需求: 4.1, 7.1_

- [ ] 7.3 集成错误处理系统

  - 实现全局错误捕获和处理机制
  - 创建错误恢复和降级策略
  - 编写错误处理的测试场景
  - _需求: 1.4, 2.4, 5.4_

- [ ] 8. 开发 Idle 游戏用户界面
- [ ] 8.1 创建顶部分类栏组件

  - 实现 CategoryBar 组件，显示所有物品分类
  - 创建分类切换功能和状态管理
  - 实现分类图标和物品计数显示
  - 编写分类栏的单元测试
  - _需求: 7.1_

- [ ] 8.2 构建左侧物品列表组件

  - 实现 ItemList 组件，显示选中分类的物品
  - 创建物品搜索、排序和过滤功能
  - 实现物品状态指示（数量、生产速率、解锁状态）
  - 编写物品列表的交互测试
  - _需求: 7.2_

- [ ] 8.3 开发右侧物品详情面板

  - 实现 ItemDetail 组件的标签页结构
  - 创建信息标签页，显示物品详细信息
  - 实现手动操作标签页（采集、合成按钮）
  - 编写详情面板的功能测试
  - _需求: 7.3, 7.4_

- [ ] 8.4 实现自动化配置界面

  - 创建 AutomationTab 组件，支持设备选择和升级
  - 实现模块插槽系统和信标配置
  - 创建效率计算和升级成本显示
  - 编写自动化配置的集成测试
  - _需求: 7.5, 2.1, 6.1_

- [ ] 8.5 构建存储管理界面

  - 实现 StorageTab 组件，支持存储上限配置
  - 创建存储升级购买和效果预览
  - 实现存储状态的实时更新
  - 编写存储管理的测试用例
  - _需求: 7.6, 1.4_

- [ ] 9. 集成现有游戏数据
- [ ] 9.1 创建 Factorio 数据加载器

  - 实现 FactorioDataProcessor 类，加载 data.json 中的完整数据结构
  - 创建类型安全的物品分类系统（Machine, Technology, Module, Beacon 等）
  - 实现类型检查和过滤方法，支持 TypeScript 类型守卫
  - 创建图标精灵图系统，支持 66px 网格的 CSS 定位和 iconText 文本叠加
  - 处理 iconText 字段，支持科技等级、温度等图标文本显示
  - 实现品质系统解析，处理 hash.json 中的(1)(2)(3)(5)品质后缀
  - 编写数据加载和解析的单元测试
  - _需求: 1.1, 2.1, 3.1_

- [ ] 9.2 实现本地化系统

  - 创建 LocalizationManager，支持中文、日文等多语言
  - 实现动态语言切换和本地化名称获取
  - 集成 categories、items、recipes 的翻译数据
  - 编写本地化系统的完整测试用例
  - _需求: 7.1, 7.2_

- [ ] 9.3 构建数据适配层

  - 实现 Factorio 数据到游戏系统的转换器
  - 处理 machine、beacon、module、fuel 等完整属性系统
  - 支持信标系统和模块效果计算（速度、产能、品质、功耗）
  - 实现 prodUpgrades 系统，支持科技对特定配方的生产力加成
  - 构建生产链分析器，自动识别物品的生产者和消费者关系
  - 实现星球位置系统，支持不同星球的建筑限制
  - 处理燃料系统，支持多种燃料类型和能量值
  - 创建数据适配的集成测试和验证
  - _需求: 1.1, 2.1, 3.1, 5.1, 6.1_

- [ ] 10. 性能优化和最终集成
- [ ] 10.1 实现性能监控

  - 创建游戏性能指标的收集机制
  - 实现内存使用和计算效率的监控
  - 编写性能测试的基准用例
  - _需求: 7.1, 7.2_

- [ ] 10.2 优化核心算法

  - 优化资源计算和生产链算法的性能
  - 实现批量处理和增量计算优化
  - 编写优化效果的性能测试
  - _需求: 4.3, 5.2, 5.3_

- [ ] 10.3 完成最终集成测试
  - 创建完整游戏流程的端到端测试
  - 验证所有功能的集成和数据一致性
  - 编写用户场景的自动化测试
  - _需求: 1.1-7.4_
