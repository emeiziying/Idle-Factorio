# 物流系统简化设计

## 核心概念

取消设施自动获取库存的功能，改为必须配置传送带和机械臂才能让设施正常工作。

## 设计方案

### 1. 生产设施的物流需求

每个生产设施需要：
- **输入物流**：机械臂/传送带将原料送入
- **输出物流**：机械臂/传送带将产品送出

### 2. 物流设备能力

#### 传送带（用于长距离、大批量传输）
- 基础传送带：15 物品/秒
- 快速传送带：30 物品/秒  
- 极速传送带：45 物品/秒

#### 机械臂（用于精确投放和抓取）
- 基础机械臂：0.83 物品/秒
- 快速机械臂：2.31 物品/秒
- 极速机械臂：6.92 物品/秒

### 3. 效率计算公式

```typescript
// 设施实际生产效率计算
实际生产速率 = Math.min(
  设施基础产能,
  输入物流能力,
  输出物流能力
)

// 输入物流能力 = 所有输入物流设备的速率总和
// 输出物流能力 = 所有输出物流设备的速率总和
```

### 4. UI设计

在物品详情的生产设施部分：

```
┌─────────────────────────────────┐
│ 🏭 电力采掘机 (3台)              │
├─────────────────────────────────┤
│ 基础产能: 15.0/秒                │
│ 实际产能: 10.0/秒 ⚠️             │
├─────────────────────────────────┤
│ 📥 输入物流                      │
│ 需求: 0/秒 ✓                    │
│ 配置: 无需输入                   │
├─────────────────────────────────┤
│ 📤 输出物流                      │
│ 需求: 15.0/秒                    │
│ 当前: 10.0/秒 (不足)             │
│ 传送带: [0] [-][+]               │
│ 机械臂: [2] [-][+]               │
├─────────────────────────────────┤
│ 建议：再添加1个快速机械臂        │
└─────────────────────────────────┘
```

### 5. 物流配置示例

#### 示例1：铁矿开采
- 电力采掘机产能：5个/秒
- 需要输出物流：≥5个/秒
- 方案A：1个快速传送带（30/秒，充足）
- 方案B：3个快速机械臂（6.93/秒，充足）
- 方案C：1个传送带 + 1个机械臂（混合方案）

#### 示例2：铁板冶炼
- 电炉消耗：2个铁矿/秒，产出2个铁板/秒
- 输入需求：≥2个/秒
- 输出需求：≥2个/秒
- 最小配置：输入1个快速机械臂，输出1个快速机械臂

### 6. 智能推荐算法

```typescript
function calculateLogisticsRequirement(facility: Facility) {
  const inputRate = facility.consumptionRate;
  const outputRate = facility.productionRate;
  
  // 计算最优配置
  const recommendations = {
    input: optimizeLogistics(inputRate),
    output: optimizeLogistics(outputRate)
  };
  
  return recommendations;
}

function optimizeLogistics(requiredRate: number) {
  // 优先使用传送带（成本效益高）
  if (requiredRate <= 15) {
    return { conveyors: 1, inserters: 0 };
  }
  
  // 混合方案
  const conveyors = Math.floor(requiredRate / 15);
  const remaining = requiredRate - conveyors * 15;
  const inserters = Math.ceil(remaining / 2.31);
  
  return { conveyors, inserters };
}
```

### 7. 实施要点

1. **移除自动获取**：设施不再自动从库存获取物品
2. **强制配置**：必须配置物流设备才能生产
3. **实时计算**：根据物流配置实时计算实际产能
4. **瓶颈提示**：明确显示哪里是瓶颈
5. **智能建议**：提供最优配置建议

### 8. 数据结构

```typescript
interface FacilityLogistics {
  facilityId: string;
  facilityCount: number;
  
  // 基础能力
  baseConsumption: number; // 基础消耗速率
  baseProduction: number;  // 基础产出速率
  
  // 物流配置
  inputLogistics: {
    conveyors: number;      // 传送带数量
    conveyorType: string;   // 传送带类型
    inserters: number;      // 机械臂数量
    inserterType: string;   // 机械臂类型
  };
  
  outputLogistics: {
    conveyors: number;
    conveyorType: string;
    inserters: number;
    inserterType: string;
  };
  
  // 实际能力
  actualConsumption: number;
  actualProduction: number;
  efficiency: number;        // 效率百分比
  bottleneck?: 'input' | 'output' | 'none';
}
```