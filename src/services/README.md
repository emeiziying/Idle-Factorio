# æœåŠ¡å±‚æ¶æ„è¯´æ˜

## æ¦‚è¿°

æœ¬é¡¹ç›®é‡‡ç”¨**ç°ä»£åŒ–ä¾èµ–æ³¨å…¥(DI)æ¶æ„**ï¼Œä¸ºIdle Factorioæ¸¸æˆæä¾›ç»Ÿä¸€ã€ç±»å‹å®‰å…¨çš„æœåŠ¡ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚æ‰€æœ‰æœåŠ¡é€šè¿‡DIå®¹å™¨è¿›è¡Œç®¡ç†ï¼Œç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œæ‰©å±•æ€§ã€‚

## ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹

- **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨è‡ªç ”DIå®¹å™¨ç®¡ç†æ‰€æœ‰æœåŠ¡
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹æ”¯æŒ
- **Reacté›†æˆ**: ä¸“ç”¨Hookå°è£…ï¼Œä¼˜åŒ–Reactç»„ä»¶æ€§èƒ½
- **æ¨¡å—åŒ–**: æŒ‰ä¸šåŠ¡é¢†åŸŸæ¸…æ™°åˆ†ç»„
- **æµ‹è¯•å‹å¥½**: æ˜“äºæ¨¡æ‹Ÿå’Œå•å…ƒæµ‹è¯•

## ğŸ“ ç›®å½•ç»“æ„

```
services/
â”œâ”€â”€ core/                     # æ ¸å¿ƒåŸºç¡€æœåŠ¡
â”‚   â”œâ”€â”€ DataService.ts            # æ•°æ®ç®¡ç†æœåŠ¡ - æ¸¸æˆæ•°æ®åŠ è½½ä¸è®¿é—®
â”‚   â”œâ”€â”€ GameConfig.ts             # æ¸¸æˆé…ç½®æœåŠ¡ - å…¨å±€é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ DIContainer.ts            # DIå®¹å™¨å®ç° - ä¾èµ–æ³¨å…¥æ ¸å¿ƒ
â”‚   â”œâ”€â”€ DIServiceInitializer.ts   # DIæœåŠ¡åˆå§‹åŒ–å™¨ - æœåŠ¡æ³¨å†Œä¸å¯åŠ¨
â”‚   â”œâ”€â”€ ServiceTokens.ts          # æœåŠ¡ä»¤ç‰Œå®šä¹‰ - ç±»å‹å®‰å…¨çš„æœåŠ¡æ ‡è¯†
â”‚   â””â”€â”€ index.ts                  # æ ¸å¿ƒæœåŠ¡å¯¼å‡º
â”‚
â”œâ”€â”€ game/                     # æ¸¸æˆé€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ GameLoopService.ts        # æ¸¸æˆå¾ªç¯æœåŠ¡ - ç»Ÿä¸€çš„æ¸¸æˆä¸»å¾ªç¯
â”‚   â”œâ”€â”€ GameLoopTaskFactory.ts    # æ¸¸æˆå¾ªç¯ä»»åŠ¡å·¥å‚ - å¾ªç¯ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ PowerService.ts           # ç”µåŠ›ç®¡ç†æœåŠ¡ - ç”µåŠ›ç”Ÿäº§ä¸æ¶ˆè€—
â”‚   â”œâ”€â”€ UserProgressService.ts    # ç”¨æˆ·è¿›åº¦æœåŠ¡ - æ¸¸æˆè¿›åº¦è¿½è¸ª
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ crafting/                 # åˆ¶ä½œç³»ç»ŸæœåŠ¡
â”‚   â”œâ”€â”€ RecipeService.ts          # é…æ–¹ç®¡ç†æœåŠ¡ - é…æ–¹æŸ¥è¯¢ä¸åˆ†æ
â”‚   â”œâ”€â”€ FuelService.ts            # ç‡ƒæ–™ç®¡ç†æœåŠ¡ - ç‡ƒæ–™ä¼˜å…ˆçº§ä¸åˆ†é…
â”‚   â”œâ”€â”€ DependencyService.ts      # åˆ¶ä½œä¾èµ–åˆ†ææœåŠ¡ - ææ–™éœ€æ±‚è®¡ç®—
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ storage/                  # å­˜å‚¨ç›¸å…³æœåŠ¡
â”‚   â”œâ”€â”€ GameStorageService.ts     # æ¸¸æˆå­˜å‚¨æœåŠ¡ - å­˜æ¡£ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–
â”‚   â”œâ”€â”€ StorageService.ts         # å­˜å‚¨é…ç½®æœåŠ¡ - å­˜å‚¨å®¹å™¨é…ç½®ç®¡ç†
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ technology/               # ç§‘æŠ€ç³»ç»ŸæœåŠ¡
â”‚   â”œâ”€â”€ TechnologyService.ts      # ç§‘æŠ€ä¸»æœåŠ¡ - ç§‘æŠ€ç³»ç»Ÿåè°ƒ
â”‚   â”œâ”€â”€ TechTreeService.ts        # ç§‘æŠ€æ ‘ç®¡ç† - ç§‘æŠ€ä¾èµ–å…³ç³»
â”‚   â”œâ”€â”€ TechUnlockService.ts      # è§£é”ç®¡ç† - ç§‘æŠ€è§£é”é€»è¾‘
â”‚   â”œâ”€â”€ ResearchService.ts        # ç ”ç©¶è¿›åº¦ç®¡ç† - ç ”ç©¶çŠ¶æ€è¿½è¸ª
â”‚   â”œâ”€â”€ ResearchQueueService.ts   # ç ”ç©¶é˜Ÿåˆ— - ç ”ç©¶ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
â”‚   â”œâ”€â”€ TechProgressTracker.ts    # è¿›åº¦ç»Ÿè®¡ - ç§‘æŠ€è¿›åº¦ç»Ÿè®¡
â”‚   â”œâ”€â”€ TechDataLoader.ts         # æ•°æ®åŠ è½½ - ç§‘æŠ€æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ events.ts                 # äº‹ä»¶ç³»ç»Ÿ - ç§‘æŠ€äº‹ä»¶å‘å¸ƒè®¢é˜…
â”‚   â”œâ”€â”€ types.ts                  # å†…éƒ¨ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ interfaces/               # æœåŠ¡æ¥å£å®šä¹‰
â”‚   â””â”€â”€ IManualCraftingValidator.ts  # æ‰‹åŠ¨åˆ¶ä½œéªŒè¯å™¨æ¥å£
â”‚
â”œâ”€â”€ interfaces.ts             # é€šç”¨æœåŠ¡æ¥å£ (ä¿ç•™ç”¨äºæ‰©å±•)
â””â”€â”€ index.ts                  # ç»Ÿä¸€æœåŠ¡å¯¼å‡º
```

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### 1. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æœåŠ¡ (æ¨è)

```typescript
import { useDataService, useRecipeService } from '@/hooks/useDIServices';

function ProductionComponent() {
  const dataService = useDataService();
  const recipeService = useRecipeService();

  const item = dataService.getItemById('iron-plate');
  const recipes = recipeService.getRecipesThatProduce('iron-plate');

  return <div>{/* UIé€»è¾‘ */}</div>;
}
```

### 2. åœ¨æœåŠ¡ä¸­ä½¿ç”¨å…¶ä»–æœåŠ¡

```typescript
import { getService } from '@/services/core/DIServiceInitializer';
import { SERVICE_TOKENS } from '@/services/core/ServiceTokens';
import type { DataService } from '@/services/core/DataService';

export class MyService {
  private dataService: DataService;

  constructor() {
    this.dataService = getService<DataService>(SERVICE_TOKENS.DATA_SERVICE);
  }
}
```

### 3. å¯ç”¨çš„Hookåˆ—è¡¨

```typescript
// æ ¸å¿ƒæœåŠ¡
useDataService()           // æ•°æ®ç®¡ç†æœåŠ¡
useGameConfig()           // æ¸¸æˆé…ç½®æœåŠ¡

// ä¸šåŠ¡æœåŠ¡
useRecipeService()        // é…æ–¹ç®¡ç†æœåŠ¡
useDependencyService()    // ä¾èµ–åˆ†ææœåŠ¡
useTechnologyService()    // ç§‘æŠ€ç®¡ç†æœåŠ¡
useUserProgressService()  // ç”¨æˆ·è¿›åº¦æœåŠ¡
useFuelService()         // ç‡ƒæ–™ç®¡ç†æœåŠ¡
usePowerService()        // ç”µåŠ›ç®¡ç†æœåŠ¡
useStorageService()      // å­˜å‚¨æœåŠ¡
useGameLoopService()     // æ¸¸æˆå¾ªç¯æœåŠ¡

// å·¥å…·æœåŠ¡
useManualCraftingValidator()  // æ‰‹åŠ¨åˆ¶ä½œéªŒè¯å™¨

// é€šç”¨Hook
useService<T>(token)      // é€šç”¨æœåŠ¡è·å–
useCommonServices()       // å¸¸ç”¨æœåŠ¡ç»„åˆ
```

## ğŸ¯ æœåŠ¡åŠŸèƒ½è¯´æ˜

### Coreï¼ˆæ ¸å¿ƒæœåŠ¡ï¼‰

- **DataService**: ç®¡ç†æ¸¸æˆåŸºç¡€æ•°æ®ï¼Œæä¾›ç‰©å“ã€é…æ–¹ã€ç§‘æŠ€ç­‰æ•°æ®è®¿é—®
- **GameConfig**: ç®¡ç†æ¸¸æˆé…ç½®å¸¸é‡ï¼Œå¦‚åˆ¶ä½œæ—¶é—´ã€ç‡ƒæ–™é˜ˆå€¼ç­‰
- **DIContainer**: DIå®¹å™¨å®ç°ï¼Œè´Ÿè´£æœåŠ¡çš„æ³¨å†Œã€è§£æå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- **DIServiceInitializer**: æœåŠ¡åˆå§‹åŒ–å™¨ï¼Œç»Ÿä¸€ç®¡ç†æœåŠ¡çš„æ³¨å†Œå’Œå¯åŠ¨æµç¨‹
- **ServiceTokens**: å®šä¹‰ç±»å‹å®‰å…¨çš„æœåŠ¡ä»¤ç‰Œï¼Œé¿å…å­—ç¬¦ä¸²ç¡¬ç¼–ç 

### Gameï¼ˆæ¸¸æˆé€»è¾‘ï¼‰

- **GameLoopService**: ç»Ÿä¸€çš„æ¸¸æˆä¸»å¾ªç¯ï¼Œä½¿ç”¨requestAnimationFrameä¼˜åŒ–æ€§èƒ½
- **GameLoopTaskFactory**: æ¸¸æˆå¾ªç¯ä»»åŠ¡å·¥å‚ï¼Œç®¡ç†å„ç§æ¸¸æˆç³»ç»Ÿçš„æ›´æ–°ä»»åŠ¡
- **PowerService**: ç”µåŠ›ç³»ç»Ÿç®¡ç†ï¼Œè®¡ç®—ç”µåŠ›ç”Ÿäº§ã€æ¶ˆè€—å’Œå¹³è¡¡
- **UserProgressService**: ç”¨æˆ·è¿›åº¦è¿½è¸ªï¼Œç®¡ç†è§£é”çŠ¶æ€å’Œæ¸¸æˆè¿›åº¦

### Craftingï¼ˆåˆ¶ä½œç³»ç»Ÿï¼‰

- **RecipeService**: é…æ–¹ç®¡ç†ï¼Œæä¾›é…æ–¹æŸ¥è¯¢ã€æ•ˆç‡åˆ†æå’Œä¾èµ–è®¡ç®—
- **FuelService**: ç‡ƒæ–™ç®¡ç†ï¼Œå¤„ç†ç‡ƒæ–™ä¼˜å…ˆçº§ã€åˆ†é…å’Œè‡ªåŠ¨è¡¥å……
- **DependencyService**: åˆ¶ä½œä¾èµ–åˆ†æï¼Œè®¡ç®—å¤æ‚åˆ¶ä½œé“¾çš„ææ–™éœ€æ±‚

### Storageï¼ˆå­˜å‚¨ç³»ç»Ÿï¼‰

- **GameStorageService**: æ¸¸æˆå­˜æ¡£ç®¡ç†ï¼Œå¤„ç†æ•°æ®åºåˆ—åŒ–ã€å‹ç¼©å’ŒæŒä¹…åŒ–
- **StorageService**: å­˜å‚¨å®¹å™¨é…ç½®ï¼Œç®¡ç†å„ç§å­˜å‚¨è®¾å¤‡çš„é…ç½®å’Œå®¹é‡

### Technologyï¼ˆç§‘æŠ€ç³»ç»Ÿï¼‰

- **TechnologyService**: ç§‘æŠ€ç³»ç»Ÿä¸»æœåŠ¡ï¼Œåè°ƒå„ä¸ªç§‘æŠ€å­ç³»ç»Ÿ
- **TechTreeService**: ç§‘æŠ€æ ‘ç®¡ç†ï¼Œå¤„ç†ç§‘æŠ€é—´çš„ä¾èµ–å…³ç³»
- **TechUnlockService**: è§£é”ç®¡ç†ï¼Œå¤„ç†ç§‘æŠ€è§£é”é€»è¾‘å’Œè§¦å‘æ¡ä»¶
- **ResearchService**: ç ”ç©¶è¿›åº¦ç®¡ç†ï¼Œè¿½è¸ªå½“å‰ç ”ç©¶çŠ¶æ€
- **ResearchQueueService**: ç ”ç©¶é˜Ÿåˆ—ç®¡ç†ï¼Œå¤„ç†ç ”ç©¶ä»»åŠ¡çš„æ’é˜Ÿå’Œè°ƒåº¦
- **TechProgressTracker**: ç§‘æŠ€è¿›åº¦ç»Ÿè®¡ï¼Œæä¾›ç§‘æŠ€è¿›åº¦çš„ç»Ÿè®¡ä¿¡æ¯

## ğŸš€ æ¶æ„ä¼˜åŠ¿

### ç›¸æ¯”ä¼ ç»Ÿæ¨¡å¼çš„æ”¹è¿›

| ç‰¹æ€§ | ä¼ ç»Ÿå•ä¾‹æ¨¡å¼ | DIæ¶æ„ |
|------|-------------|--------|
| **ç±»å‹å®‰å…¨** | è¿è¡Œæ—¶é”™è¯¯é£é™© | ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ |
| **æµ‹è¯•å‹å¥½** | éš¾ä»¥æ¨¡æ‹Ÿä¾èµ– | æ˜“äºä¾èµ–æ³¨å…¥å’Œæ¨¡æ‹Ÿ |
| **å¾ªç¯ä¾èµ–** | å®¹æ˜“äº§ç”Ÿé—®é¢˜ | è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç† |
| **ä»£ç è§£è€¦** | é™æ€è€¦åˆ | æ¥å£é©±åŠ¨çš„æ¾è€¦åˆ |
| **ç»´æŠ¤æˆæœ¬** | éšå¼ä¾èµ–å…³ç³» | æ˜¾å¼ä¾èµ–å£°æ˜ |

### Reactç”Ÿæ€é›†æˆ

- **è‡ªå®šä¹‰Hook**: å°è£…æœåŠ¡è®¿é—®ï¼Œæä¾›Reactå‹å¥½çš„API
- **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨useMemoç¼“å­˜æœåŠ¡å®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»º
- **ç±»å‹æ¨å¯¼**: å®Œæ•´çš„TypeScriptç±»å‹æ¨å¯¼æ”¯æŒ
- **å¼€å‘ä½“éªŒ**: ä¸React DevToolså’Œå…¶ä»–å¼€å‘å·¥å…·è‰¯å¥½é›†æˆ

## ğŸ“ˆ æœ€ä½³å®è·µ

### DO âœ…

- ä½¿ç”¨ä¸“ç”¨Hookè·å–æœåŠ¡å®ä¾‹
- åœ¨æœåŠ¡æ„é€ å‡½æ•°ä¸­æ³¨å…¥ä¾èµ–
- ä½¿ç”¨SERVICE_TOKENSå¸¸é‡è€Œéå­—ç¬¦ä¸²
- ä¸ºæ–°æœåŠ¡ç¼–å†™å¯¹åº”çš„Hook

### DON'T âŒ

- ä¸è¦åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨getService
- ä¸è¦åœ¨Hookå¤–éƒ¨ç¼“å­˜æœåŠ¡å®ä¾‹
- ä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºæœåŠ¡æ ‡è¯†
- ä¸è¦åœ¨æœåŠ¡ä¸­ç›´æ¥è®¿é—®ReactçŠ¶æ€

## ğŸ”„ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°æœåŠ¡

1. **å®šä¹‰æœåŠ¡ä»¤ç‰Œ**
```typescript
// ServiceTokens.ts
export const SERVICE_TOKENS = {
  // ...existing tokens
  MY_NEW_SERVICE: 'MyNewService',
};
```

2. **æ³¨å†ŒæœåŠ¡**
```typescript
// DIServiceInitializer.ts
container.register(SERVICE_TOKENS.MY_NEW_SERVICE, MyNewService);
```

3. **åˆ›å»ºHook**
```typescript
// useDIServices.ts
export const useMyNewService = (): MyNewService => {
  return useMemo(() => getService<MyNewService>(SERVICE_TOKENS.MY_NEW_SERVICE), []);
};
```

4. **åœ¨ç»„ä»¶ä¸­ä½¿ç”¨**
```typescript
const myService = useMyNewService();
```

## ğŸ‰ æ€»ç»“

ä¾èµ–æ³¨å…¥æ¶æ„ä¸ºIdle Factorioæä¾›äº†ç°ä»£åŒ–ã€å¯ç»´æŠ¤çš„æœåŠ¡ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ç»Ÿä¸€çš„DIå®¹å™¨å’Œç±»å‹å®‰å…¨çš„Hookç³»ç»Ÿï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°è®¿é—®å’Œæ‰©å±•å„ç§æ¸¸æˆæœåŠ¡ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ¸…æ´å’Œå¯æµ‹è¯•æ€§ã€‚

è¿™ä¸€æ¶æ„ä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å’Œå›¢é˜Ÿåä½œå¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚