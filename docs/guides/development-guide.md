# 开发指南

## 项目概述

**Idle Factorio** - React-based idle factory management game inspired by Factorio

**技术栈**: React + TypeScript + Material-UI + Zustand

## 开发阶段

本项目采用阶段性开发方式，逐步构建完整的游戏系统。

### 第一阶段：基础架构和核心系统

#### 已完成功能 ✅

1. **电力生产系统**
   - 完整的水→蒸汽→电力生产链
   - 电力平衡监控
   - 智能电力分配

2. **设备自动化管理**
   - 基于配方的智能设备创建
   - 设备状态管理
   - 自动生产控制

3. **实时监控系统**
   - 电力平衡监控
   - 设备状态跟踪
   - 效率分析报告

4. **存储系统**
   - 基于堆叠的存储机制
   - 容器扩展系统
   - 存档优化（70-80%压缩率）

5. **燃料系统**
   - 独立燃料缓存区
   - 自动燃料补充
   - 燃料消耗计算

6. **用户界面**
   - 响应式设计
   - 模块化组件架构
   - 实时数据更新

#### 待完成功能 🔄

- [ ] 科技研究系统
- [ ] 研究队列管理
- [ ] 成就系统
- [ ] 教程引导

### 第二阶段：物流驱动生产系统

#### 核心目标

实现真实的物流限制系统，让生产效率受到物流能力的制约：

`实际产能 = MIN(基础产能, 输入物流能力, 输出物流能力)`

#### 新增功能

1. **物流设备系统**
   - 传送带：黄色(15/s)、红色(30/s)、蓝色(45/s)
   - 机械臂：基础(0.83/s)、快速(2.31/s)、极速(5.0/s)
   - 设备数量管理和库存消耗

2. **效率计算系统**
   - 瓶颈自动分析
   - 实时效率显示
   - 效率颜色编码
   - 详细效率报告

3. **物流配置界面**
   - 可视化配置面板
   - 实时效率预览
   - 操作反馈系统
   - 批量配置支持

4. **智能优化系统**
   - 一键优化功能
   - 多种优化策略
   - 成本效益分析
   - 升级路径规划

5. **生产链分析**
   - 完整生产链可视化
   - 链式瓶颈分析
   - 产能平衡建议
   - 原料需求预测

## 系统架构

### 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                     前端应用 (React)                      │
├─────────────────────────────────────────────────────────┤
│                   状态管理层 (Zustand)                    │
├─────────────────────────────────────────────────────────┤
│                     服务层 (Services)                     │
├─────────────────────────────────────────────────────────┤
│                   数据持久化 (LocalStorage)              │
└─────────────────────────────────────────────────────────┘
```

### 目录结构

```
src/
├── components/          # UI组件
│   ├── common/         # 通用组件
│   ├── production/     # 生产模块
│   ├── facilities/     # 设施模块
│   ├── technology/     # 科技模块
│   └── logistics/      # 物流模块
├── services/           # 业务逻辑服务
│   ├── DataService.ts          # 游戏数据管理
│   ├── UserProgressService.ts  # 用户进度管理
│   ├── FacilityService.ts      # 设施管理
│   ├── PowerService.ts         # 电力系统
│   ├── FuelService.ts          # 燃料系统
│   ├── SaveOptimizationService.ts # 存档优化
│   └── SimpleLogisticsService.ts  # 物流系统
├── store/              # Zustand状态管理
├── types/              # TypeScript类型定义
├── utils/              # 工具函数
└── data/               # 游戏数据配置
```

## 开发规范

### 代码风格

1. **TypeScript严格模式**
   - 使用严格类型检查
   - 避免使用any类型
   - 定义清晰的接口

2. **组件设计**
   - 优先使用函数组件
   - 使用React Hooks
   - 保持组件职责单一

3. **状态管理**
   - 使用Zustand进行全局状态管理
   - 避免组件间的深度props传递
   - 合理划分状态片段

### 性能优化

1. **React优化**
   - 使用React.memo优化组件渲染
   - 合理使用useMemo和useCallback
   - 避免在渲染中创建新对象

2. **数据更新**
   - 批量更新而非频繁小更新
   - 使用防抖和节流
   - 缓存计算结果

3. **存储优化**
   - 使用SaveOptimizationService
   - 实施数据压缩
   - 定期清理无用数据

### 测试策略

1. **单元测试**
   - 服务层逻辑测试
   - 工具函数测试
   - 核心算法验证

2. **集成测试**
   - 组件交互测试
   - 状态管理测试
   - API调用测试

3. **性能测试**
   - 大数据量场景
   - 内存泄漏检查
   - 渲染性能分析

## 部署流程

### 开发环境

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev

# 运行测试
pnpm test

# 代码检查
pnpm lint
```

### 生产构建

```bash
# 构建生产版本
pnpm build

# 预览构建结果
pnpm preview

# 分析包大小
pnpm analyze
```

### 版本管理

1. **分支策略**
   - main: 稳定版本
   - develop: 开发版本
   - feature/*: 功能开发
   - hotfix/*: 紧急修复

2. **提交规范**
   - feat: 新功能
   - fix: 修复问题
   - docs: 文档更新
   - style: 代码格式
   - refactor: 重构
   - test: 测试相关
   - chore: 构建/工具

## 未来规划

### 短期目标（1-2个月）

1. 完成科技研究系统
2. 实现成就和统计系统
3. 添加新手教程
4. 优化移动端体验

### 中期目标（3-6个月）

1. 多人协作功能
2. 模组支持系统
3. 地图编辑器
4. 高级自动化功能

### 长期愿景

1. 完整还原Factorio核心玩法
2. 创新的idle游戏机制
3. 活跃的社区生态
4. 持续的内容更新

## 贡献指南

欢迎社区贡献！请遵循以下步骤：

1. Fork项目仓库
2. 创建功能分支
3. 提交代码变更
4. 编写测试用例
5. 提交Pull Request

详细贡献指南请参考 [CONTRIBUTING.md](../../CONTRIBUTING.md)

## 常见问题

### Q: 如何添加新的物品？
A: 在`data/items.json`中添加物品数据，确保包含所有必需字段。

### Q: 如何实现新的生产设施？
A: 1. 在数据文件中定义设施
   2. 实现对应的服务逻辑
   3. 创建UI组件
   4. 集成到游戏循环

### Q: 性能问题如何排查？
A: 使用React DevTools Profiler分析组件渲染，检查是否有不必要的重渲染。

更多问题请查看 [FAQ.md](../../FAQ.md) 或在Issues中提问。