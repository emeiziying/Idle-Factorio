# 第一阶段开发步骤指南

## 📋 概述

本指南提供了第一阶段开发的详细步骤，按照依赖关系和优先级排序，确保开发过程顺畅高效。

## 🚀 开发步骤

### Step 1: 项目初始化

#### 1.1 创建项目
```bash
npx create-react-app factorio-game --template typescript
cd factorio-game
```

#### 1.2 安装依赖
```bash
# UI框架
npm install @mui/material @emotion/react @emotion/styled
npm install @mui/icons-material

# 类型定义
npm install --save-dev @types/react @types/node
```

#### 1.3 项目结构设置
```
src/
├── components/
├── services/
├── types/
├── hooks/
├── utils/
└── data/
```

---

### Step 2: 基础类型定义

#### 2.1 创建 `src/types/index.ts`
```typescript
export interface Category {
  id: string;
  name: string;
  icon?: string;
}

export interface Item {
  id: string;
  name: string;
  category: string;
  subgroup?: string;
  description?: string;
  icon?: string;
  stack_size?: number;
  fuel_value?: string;
  type?: string;
  unlocked?: boolean;
}

export interface Recipe {
  id: string;
  name: string;
  category: string;
  time: number;
  in: { [itemId: string]: number };
  out: { [itemId: string]: number };
}

export interface InventoryItem {
  itemId: string;
  currentAmount: number;
  maxCapacity: number;
  productionRate: number;
  consumptionRate: number;
  status: 'producing' | 'stopped' | 'insufficient' | 'inventory_full' | 'researching' | 'normal';
}
```

#### 2.2 创建 `src/types/facilities.ts`
```typescript
export interface Facility {
  id: string;
  itemId: string;
  type: string;
  category: 'mining' | 'smelting' | 'crafting' | 'chemical' | 'research' | 'power-generation';
  count: number;
  baseSpeed: number;
  baseInputRate: Record<string, number>;
  baseOutputRate: number;
  powerType: 'electric' | 'fuel' | 'none';
  powerConsumption?: number;
  powerGeneration?: number;
}
```

---

### Step 3: 核心服务层

#### 3.1 用户进度服务 `src/services/UserProgressService.ts`
- 实现单例模式
- 管理物品解锁状态
- localStorage 持久化
- 默认解锁基础物品

#### 3.2 数据服务 `src/services/DataService.ts`
- 加载游戏数据（从 public/data/）
- 集成解锁状态过滤
- 提供物品查询接口
- 管理库存状态

#### 3.3 设施服务 `src/services/FacilityService.ts`
- 管理设施实例
- 计算生产效率
- 处理设施状态

#### 3.4 电力服务 `src/services/PowerService.ts`
- 计算电力平衡
- 管理发电/用电设施
- 提供电力统计

---

### Step 4: UI基础框架

#### 4.1 主应用布局 `src/App.tsx`
```typescript
function App() {
  const [selectedTab, setSelectedTab] = useState(0);
  
  return (
    <Box sx={{ display: 'flex', flexDirection: 'column', height: '100vh' }}>
      {/* 主内容区 */}
      <Box sx={{ flex: 1, overflow: 'auto' }}>
        {selectedTab === 0 && <ProductionModule />}
        {selectedTab === 1 && <FacilitiesModule />}
        {selectedTab === 2 && <TechnologyModule />}
      </Box>
      
      {/* 底部导航 */}
      <BottomNavigation value={selectedTab} onChange={(e, v) => setSelectedTab(v)}>
        <BottomNavigationAction label="生产" icon={<BuildIcon />} />
        <BottomNavigationAction label="设施" icon={<FactoryIcon />} />
        <BottomNavigationAction label="科技" icon={<ScienceIcon />} />
      </BottomNavigation>
    </Box>
  );
}
```

---

### Step 5: 生产模块开发

#### 5.1 分类标签组件 `src/components/CategoryTabs.tsx`
- 显示六大分类（物流、生产、中间产品、战斗、流体、科技）
- 响应式布局
- 分类切换功能

#### 5.2 物品网格组件 `src/components/ItemGrid.tsx`
- 网格布局展示物品
- 仅显示已解锁物品
- 响应式设计（移动端2列，桌面端4列）

#### 5.3 物品卡片组件 `src/components/ItemCard.tsx`
- 显示物品图标、名称、库存
- 点击触发详情
- 状态指示器（生产中、停止等）

#### 5.4 物品详情对话框 `src/components/ItemDetailDialog.tsx`
- 显示完整物品信息
- 配方列表
- 制作功能
- 生产链信息

---

### Step 6: 设施模块开发

#### 6.1 设施概览 `src/components/FacilityOverview.tsx`
- 按类别分组显示设施
- 显示运行状态和效率
- 批量操作功能

#### 6.2 电力管理面板 `src/components/PowerManagementPanel.tsx`
- 电力总览卡片（发电量、消耗量、平衡）
- 发电设施列表
- 用电设施列表
- 效率优化建议

#### 6.3 设施配置对话框 `src/components/FacilityConfigDialog.tsx`
- 调整设施数量
- 配置生产参数
- 查看详细统计

---

### Step 7: 数据集成

#### 7.1 准备游戏数据
```
public/
└── data/
    └── 1.1/
        ├── data.json      # 物品、配方、分类数据
        ├── icons.webp     # 物品图标精灵图
        └── hash.json      # 数据版本校验
```

#### 7.2 图标组件 `src/components/common/FactorioIcon.tsx`
- 从精灵图提取图标
- 缓存机制
- 加载占位符

---

### Step 8: 状态管理

#### 8.1 使用 React Context（简单方案）
```typescript
// src/contexts/GameContext.tsx
export const GameContext = createContext<GameState>(null);

export function GameProvider({ children }) {
  const [inventory, setInventory] = useState(new Map());
  const [facilities, setFacilities] = useState([]);
  
  return (
    <GameContext.Provider value={{ inventory, facilities, ... }}>
      {children}
    </GameContext.Provider>
  );
}
```

#### 8.2 或使用 Zustand（推荐）
```typescript
// src/store/gameStore.ts
import { create } from 'zustand';

export const useGameStore = create((set) => ({
  inventory: new Map(),
  facilities: [],
  updateInventory: (itemId, amount) => set(state => {
    // 更新逻辑
  }),
}));
```

---

### Step 9: 功能完善

#### 9.1 制作队列
- 实现制作任务队列（最多10个）
- 进度计算
- 自动完成和库存更新

#### 9.2 自动保存
- 每30秒自动保存
- 保存到 localStorage
- 保存提示

#### 9.3 数据导入/导出
- JSON格式存档
- 压缩存储
- 版本兼容性检查

---

### Step 10: 优化和测试

#### 10.1 性能优化
- React.memo 优化渲染
- useMemo 缓存计算
- 虚拟滚动（物品列表）
- 图片懒加载

#### 10.2 响应式适配
- 移动端布局调整
- 触摸手势支持
- 自适应字体大小

#### 10.3 错误处理
- 全局错误边界
- 服务异常处理
- 用户友好的错误提示

---

## 📝 开发顺序建议

### 第一周：基础架构
1. ✅ 项目初始化
2. ✅ 类型定义
3. ✅ 核心服务（UserProgress, Data）
4. ✅ 基础UI框架

### 第二周：生产模块
5. ✅ 物品解锁系统
6. ✅ 物品列表展示
7. ✅ 物品详情功能
8. ✅ 制作队列

### 第三周：设施模块
9. ⬜ 设施管理界面
10. ⬜ 电力系统
11. ⬜ 设施配置功能

### 第四周：完善和优化
12. ⬜ 数据持久化
13. ⬜ 性能优化
14. ⬜ 测试和修复

---

## 🎯 关键检查点

### 检查点1：基础功能（第一周末）
- [ ] 能够显示物品列表
- [ ] 物品解锁系统正常工作
- [ ] 基础UI导航功能

### 检查点2：核心玩法（第二周末）
- [ ] 可以查看物品详情
- [ ] 可以制作物品
- [ ] 库存系统正常工作

### 检查点3：设施系统（第三周末）
- [ ] 设施可以正常添加/删除
- [ ] 电力计算准确
- [ ] 生产链可视化

### 检查点4：发布就绪（第四周末）
- [ ] 数据持久化稳定
- [ ] 性能达标（60fps）
- [ ] 无明显bug

---

## 💡 开发技巧

### 1. 组件开发顺序
- 先开发展示组件（无状态）
- 再添加交互功能
- 最后集成业务逻辑

### 2. 数据流设计
- 自上而下的数据流
- 明确的状态管理
- 避免组件间直接通信

### 3. 调试建议
- 使用 React DevTools
- 添加详细的日志
- 编写单元测试

### 4. 性能监控
- 使用 React Profiler
- 监控渲染次数
- 及时优化瓶颈

---

## 🚨 常见问题

### Q1: 物品图标无法显示
- 检查精灵图路径
- 确认图标坐标正确
- 查看控制台错误

### Q2: 解锁状态不持久
- 检查 localStorage 权限
- 确认保存逻辑执行
- 查看存储数据格式

### Q3: 性能问题
- 减少不必要的渲染
- 使用虚拟滚动
- 优化大数据结构

---

## 📚 参考资源

- [React 官方文档](https://react.dev/)
- [Material-UI 文档](https://mui.com/)
- [TypeScript 手册](https://www.typescriptlang.org/docs/)
- [Factorio Wiki](https://wiki.factorio.com/)